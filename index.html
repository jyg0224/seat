<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>랜덤 자리바꾸기</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background-color: #e6f9ee;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: space-between;
      padding: 20px 40px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    textarea, input, select, button {
      font-size: 14px;
      padding: 4px;
      width: 200px;
    }
    .seat-grid {
      display: grid;
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
    }
    .seat {
      width: 80px;
      height: 60px;
      background-color: #ccf0dd;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 2px solid #66aa88;
      border-radius: 8px;
    }
    .fixed {
      background-color: #99e6cc;
    }
    h1 {
      text-align: center;
      color: #207755;
    }
    .right-panel {
      width: 400px;
    }
    .guide {
      background: #f3e5b5;
      padding: 20px;
      font-size: 14px;
      border-radius: 10px;
    }
    #footer {
      text-align: center;
      margin-top: 30px;
      color: #666;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <label>학생 이름 입력 (쉼표 또는 줄바꿈):<br>
      <textarea id="names" rows="8"></textarea>
    </label>
    <label>행 수: <br><input id="rows" type="number" value="5"></label>
    <label>열 수: <br><input id="cols" type="number" value="6"></label>
    <label>뒷줄 채우기 방향:<br>
      <select id="direction">
        <option value="left">왼쪽부터</option>
        <option value="right">오른쪽부터</option>
      </select>
    </label>
    <button onclick="assignSeats()">자리 배치</button>
    <button onclick="saveData()">자리 저장 (인증코드 생성)</button>
    <button onclick="loadData()">자리 불러오기</button>
    <button onclick="exportPDF()">PDF 저장</button>
    <div id="footer">Made by 조영건</div>
  </div>

  <div id="seats" class="seat-grid"></div>

  <div class="right-panel">
    <div class="guide">
      <b>사용 설명서</b><br>
      1. 학생 이름을 쉼표 또는 줄바꿈을 통해 입력합니다.<br>
      2. 행 수와 열 수를 입력합니다.<br>
      3. 맨 뒷자리를 왼쪽부터 채울지, 오른쪽부터 채울지 입력합니다.<br>
      4. 자리 배치를 눌러 랜덤으로 배치합니다.<br>
      5. 배치를 완성한 후 자리 저장을 누르면 인증 코드가 부여됩니다.<br>
      6. 부여된 인증코드를 다음번에 입력하면 학생 이름을 비롯한 저장된 정보가 뜹니다.<br>
      7. 이를 활용해 다음 번 자리 배치를 할 때에 자리 불러오기 - 인증 코드만 입력해 저장된 데이터를 불러옵니다.
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCF...", // 여기에 실제 API KEY 입력
      authDomain: "...",
      databaseURL: "https://...firebaseio.com",
      projectId: "..."
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function assignSeats() {
      const nameInput = document.getElementById("names").value.trim();
      const direction = document.getElementById("direction").value;
      let names = nameInput.split(/[\n,]+/).map(n => n.trim()).filter(n => n);
      const rows = parseInt(document.getElementById("rows").value);
      const cols = parseInt(document.getElementById("cols").value);

      while (names.length < rows * cols) names.push("");
      names = names.sort(() => Math.random() - 0.5);

      const seatGrid = document.getElementById("seats");
      seatGrid.innerHTML = "";
      seatGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      for (let r = 0; r < rows; r++) {
        let row = [];
        for (let c = 0; c < cols; c++) {
          let idx = direction === "left" ? r * cols + c : r * cols + (cols - 1 - c);
          row.push(`<div class='seat'>${names[idx]}</div>`);
        }
        seatGrid.innerHTML += row.join('');
      }

      const lectern = document.createElement("div");
      lectern.style.gridColumn = `span ${cols}`;
      lectern.style.textAlign = "center";
      lectern.style.fontWeight = "bold";
      lectern.style.marginTop = "10px";
      lectern.innerText = "교탁";
      seatGrid.appendChild(lectern);
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const seats = document.querySelectorAll('.seat');
      let x = 10, y = 20, count = 0;

      seats.forEach(seat => {
        const text = seat.textContent.trim();
        pdf.setDrawColor(100);
        pdf.rect(x, y, 30, 20);
        pdf.text(text, x + 3, y + 12);
        x += 35;
        count++;
        if (count % 6 === 0) { x = 10; y += 25; }
      });

      y += 15;
      pdf.setFont(undefined, 'bold');
      pdf.text("교탁", 100, y);

      pdf.save("자리배치.pdf");
    }

    function saveData() {
      const code = Math.random().toString(36).substring(2, 8).toUpperCase();
      const data = {
        names: document.getElementById("names").value,
        rows: document.getElementById("rows").value,
        cols: document.getElementById("cols").value,
        direction: document.getElementById("direction").value
      };
      db.ref("seats/" + code).set(data).then(() => alert("저장됨! 인증코드: " + code));
    }

    function loadData() {
      const code = prompt("인증코드를 입력하세요").toUpperCase();
      db.ref("seats/" + code).get().then(snapshot => {
        const data = snapshot.val();
        if (data) {
          document.getElementById("names").value = data.names;
          document.getElementById("rows").value = data.rows;
          document.getElementById("cols").value = data.cols;
          document.getElementById("direction").value = data.direction;
          assignSeats();
        } else alert("해당 코드의 데이터가 없습니다.");
      });
    }
  </script>
</body>
</html>
